syntax = "proto3";

package chatfinbot.share.v1;

option go_package = "github.com/intellectia/chatfinbot-grpc/protobufs/share/v1;sharepb";
import "google/api/annotations.proto";
import "search/v1/search.proto";

service ShareService {
    rpc ShareChat(ShareChatReq) returns (ShareChatRsp) {
        option (google.api.http) = {
			post: "/v1/share/share-chat",
			body: "*"
		};
    }

    rpc CheckShareChat(CheckShareChatReq) returns (CheckShareChatRsp) {
        option (google.api.http) = {
			get: "/v1/share/check-chat"
		};
    }

    rpc UnshareChat(UnshareChatReq) returns (UnshareChatRsp) {
        option (google.api.http) = {
			post: "/v1/share/unshare-chat",
			body: "*"
		};
    }

    rpc GetChatInfo(GetChatInfoReq) returns (GetChatInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/chat-info"
		};
    };


    rpc ShareDoc(ShareDocReq) returns (ShareDocRsp) {
        option (google.api.http) = {
			post: "/v1/share/share-doc",
			body: "*"
		};
    }

    rpc UnshareDoc(UnshareDocReq) returns (UnshareDocRsp) {
        option (google.api.http) = {
			post: "/v1/share/unshare-doc",
			body: "*"
		};
    }

    rpc GetDocInfo(GetDocInfoReq) returns (GetDocInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/doc-info"
		};
    };

    rpc CheckShareDoc(CheckShareDocReq) returns (CheckShareDocRsp) {
        option (google.api.http) = {
			get: "/v1/share/check-doc"
		};
    }

    rpc GetAudioInfo(GetAudioInfoReq) returns (GetAudioInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/audio-info"
		};
    };

    rpc GetAudioChatInfo(GetAudioChatInfoReq) returns (GetAudioChatInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/audio-chat"
		};
    };

    rpc ShareAudio(ShareAudioReq) returns (ShareAudioRsp) {
        option (google.api.http) = {
			post: "/v1/share/share-audio",
			body: "*"
		};
    }

    rpc UnshareAudio(UnshareAudioReq) returns (UnshareAudioRsp) {
        option (google.api.http) = {
			post: "/v1/share/unshare-audio",
			body: "*"
		};
    }

    rpc CheckAudio(CheckAudioReq) returns (CheckAudioRsp) {
        option (google.api.http) = {
			get: "/v1/share/check-audio"
		};
    }

    rpc GetVideoInfo(GetVideoInfoReq) returns (GetVideoInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/video-info"
		};
    }

    // 获取公司数据 
    rpc GetCompanyInfo(GetCompanyInfoReq) returns (GetCompanyInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/company-info"
		};
    }
    // 获取公司行情指标
    rpc GetIndicators(GetIndicatorsReq) returns (GetIndicatorsRsp) {
        option (google.api.http) = {
			get: "/v1/share/indicators"
		};
    }
    // 获取公司股权结构
    rpc GetShareholders(GetShareholdersReq) returns (GetShareholdersRsp){ 
        option (google.api.http) = {
			get: "/v1/share/shareholders"
		};
    }
    // 获取公司管理层信息
    rpc GetExecutives(GetExecutivesReq) returns (GetExecutivesRsp) {
        option (google.api.http) = {
			get: "/v1/share/executives"
		};
    }
    // 获取员工构成
    rpc GetStaffInfo(GetStaffInfoReq) returns (GetStaffInfoRsp) {
        option (google.api.http) = {
			get: "/v1/share/staff-info"
		};
    }
    // 获取主营营收
    rpc GetMBRevenue(GetMBRevenueReq) returns (GetMBRevenueRsp) {
        option (google.api.http) = {
			get: "/v1/share/mbrevenue"
		};
    }
    // 获取财务概况
    rpc GetFinancial(GetFinancialReq) returns (GetFinancialRsp) {
        option (google.api.http) = {
			get: "/v1/share/financial"
		};
    }
    
    // 获取应收款
    rpc GetAccountsReceivable(GetAccountsReceivableReq) returns (GetAccountsReceivableRsp) {
        option (google.api.http) = {
			get: "/v1/share/ar"
		};
    }
    // 获取研发支出
    rpc GetRdExpenditure(GetRdExpenditureReq) returns (GetRdExpenditureRsp) {
        option (google.api.http) = {
			get: "/v1/share/rd-expenditure"
		};
    }

    rpc ShareVideo(ShareVideoReq) returns (ShareVideoRsp) {
        option (google.api.http) = {
            post: "/v1/share/share-video",
            body: "*"
        };
    }

    rpc UnshareVideo(UnshareVideoReq) returns (UnshareVideoRsp) {
        option (google.api.http) = {
            post: "/v1/share/unshare-video",
            body: "*"
        };
    }
}

message GetChatInfoReq {
    string sid = 1;
    int32 mid = 2;
}

message GetChatInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    repeated ChatHistory list = 3;
}

message ChatHistory {
    string role = 1;
    string name = 2;
    string message = 3;
    int64 message_id = 4;
    bool is_rated = 5;
    int32 rate_score = 6;
    ChatHistoryAdditionalData additional_data = 7;
    uint32 chat_type = 8; // 消息类型 0=普通消息 1=公司简介 2=行情指标 3=股东信息 4=高管 5=财务指标 6主营业务 7=员工构成
    string params = 9;
    string context = 10;
    string images = 11;
    string chat_id = 12;
}

message ChatHistoryAdditionalData {
    string references = 1;
    string plotly_graph = 2;
    repeated ChatHistoryDocuments documents = 3;
}

message ChatHistoryDocuments {
    string title = 1;   // 标题
    string name = 2; // 文件名
    string doc_id = 3; // doc id
    string type = 4;    // 文件类型
    string s3_bucket = 5; // bucket
    string s3_path = 6;  // s3路径
    string language = 7; // 语言
    int32 total_pages = 8;  // 总的页数
    string url = 9; // url
}


message GetDocInfoReq {
    string sid = 1;
    int32 mid = 2;
}

message GetDocInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    repeated ChatHistory list = 3;
}

message AudioInfo {
    string session_id = 1; // session id
    string doc_id = 2; // 文件id
    repeated MediaContent content = 3; // 内容
    string summary = 4; // 总结
    repeated MediaSummary partial_summary = 5; // 部分内容
    repeated string todo = 6; // 待办事项
    bool is_depth_summary = 7; // 是否有深度总结
    string depth_summary = 8; // 深度总结
    string url = 9; // 链接地址 
    uint32 media_type = 10; // 媒体类型 
    string notes = 11; // 笔记 
    bool is_public = 12; // 是否公开
    string notes_title = 13; // 笔记标题
}

message MediaContent {
    string start = 1;
    string text = 2;
    double duration = 3;
    string role = 4;
}

message MediaSummary {
    string start = 1;
    string text = 2;
}

message GetAudioInfoReq {
    string sid = 1;
}

message GetAudioInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    AudioInfo data = 3;  // 数据
}

message GetAudioChatInfoReq {
    string sid = 1;
    int32 mid= 2;
}

message GetAudioChatInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    repeated ChatHistory list = 3;
}


message VideoInfo {
    string session_id = 1; // Corresponds to session_id in the table
    string user_id = 2; // Corresponds to user_id in the table
    string url = 3; // Corresponds to url in the table
    string doc_id = 4; // Corresponds to doc_id in the table
    string subtitles = 5; // Subtitles (JSON string)
    string summary = 6; // Corresponds to summary in the table
    string deep_summary = 7; // Corresponds to deep_summary in the table
    string thumbnail = 8; // Corresponds to thumbnail in the table
    string created_at = 9; // Timestamp as string, corresponds to created_at
    string updated_at = 10; // Timestamp as string, corresponds to updated_at
    string deleted_at = 11; // Timestamp as string, corresponds to deleted_at
    // ... other fields as needed
}

message GetVideoInfoReq {
    string session_id = 1; // session id or other relevant fields
}

message GetVideoInfoRsp {
    int32 ret = 1; // Error code
    string msg = 2; // Message
    VideoInfo data = 3;  // Video information
}

message ShareVideoReq {
    string session_id = 1; // session id or other relevant fields
}

message ShareVideoRsp {
    int32 ret = 1; // Error code
    string msg = 2; // Message
}

message UnshareVideoReq {
    string session_id = 1; // session id or other relevant fields
}

message UnshareVideoRsp {
    int32 ret = 1; // Error code
    string msg = 2; // Message
}


message ShareChatReq {
    string sid = 1;
}

message ShareChatRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}

message UnshareChatReq {
    string sid = 1;
}

message UnshareChatRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}

message ShareDocReq {
    string sid = 1;
}

message ShareDocRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}

message UnshareDocReq {
    string sid = 1;
}

message UnshareDocRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}

message CheckShareChatReq {
    string sid = 1;
}

message CheckShareChatRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    bool is_share = 3; // 
}


message CheckShareDocReq {
    string sid = 1;
}

message CheckShareDocRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    bool is_share = 3; // 
}

message ShareAudioReq {
    string sid = 1;
}

message ShareAudioRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}

message UnshareAudioReq {
    string sid = 1;
}

message UnshareAudioRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
}


message CheckAudioReq {
    string sid = 1;
}

message CheckAudioRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    bool is_share = 3; // 
}


message GetCompanyInfoReq {
    string sid = 1;
    int32 mid = 2; 
    string code = 3; // 公司code 例如00030.SZ
}

message GetCompanyInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetCompanyInfoRsp data = 3;
}

message GetIndicatorsReq {
    string sid = 1;
    int32 mid = 2; 
    string code = 3; // 公司code 例如00030.SZ
}

message GetIndicatorsRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetIndicatorsRsp data = 3;
}

message GetShareholdersReq {
    string sid = 1;
    int32 mid = 2; 
    string code = 3; // 公司code 例如00030.SZ
}

message GetShareholdersRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetShareholdersRsp data = 3;
}

message GetExecutivesReq {
    string sid = 1;
    int32 mid = 2; 
    string code = 3; // 公司code 例如00030.SZ
}

message GetExecutivesRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetExecutivesRsp data = 3;
}

message GetStaffInfoReq {
    string sid = 1;
    int32 mid = 2; 
    uint32 stype  =3; // 3=近三年 5=近五年 10=近十年  999=上市以来 
    string code = 4; // 公司code 例如00030.SZ
}

message GetStaffInfoRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetStaffInfoRsp data = 3;
}

message GetMBRevenueReq {
    string sid = 1;
    int32 mid = 2; 
    uint32 stype  = 3; // 3=近三年 5=近五年 10=近十年  999=上市以来 
    uint32 mbtype = 4; // 类型 1=行业 2=产品 3=地区
    string code = 5; // 公司code 例如00030.SZ
    uint32 unit = 6; // 单位 0=元 1=千元 2=万元 3=百万元 4=亿元 5=十亿元
}

message GetMBRevenueRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetMBRevenueRsp data = 3;
}

message GetFinancialReq {
    string sid = 1;
    int32 mid = 2; 
    uint32 stype  = 3; // 3=近三年 5=近五年 10=近十年  999=上市以来 
    string code = 4; // 公司code 例如00030.SZ
    uint32 unit = 5; // 单位 0=元 1=千元 2=万元 3=百万元 4=亿元 5=十亿元
}

message GetFinancialRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetFinancialRsp data = 3;
}

message GetAccountsReceivableReq {
    string sid = 1;
    int32 mid = 2; 
    string code = 3; // 公司code 例如00030.SZ
    uint32 stype  = 4; // 3=近三年 5=近五年 10=近十年  999=上市以来 
    uint32 unit = 5; // 单位 0=元 1=千元 2=万元 3=百万元 4=亿元 5=十亿元
}

message GetAccountsReceivableRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetAccountsReceivableRsp data = 3;
}

message  GetRdExpenditureReq {
    string sid = 1;
    int32 mid = 2; 
    uint32 stype  = 3; // 3=近三年 5=近五年 10=近十年  999=上市以来 
    string code = 4; // 公司code 例如00030.SZ
    uint32 unit = 5; // 单位 0=元 1=千元 2=万元 3=百万元 4=亿元 5=十亿元
}

message GetRdExpenditureRsp {
    int32 ret = 1; // 错误码
    string msg = 2; // msg
    chatfinbot.search.v1.GetRdExpenditureRsp data = 3;
}



