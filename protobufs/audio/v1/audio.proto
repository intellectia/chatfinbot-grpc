syntax = "proto3";

package chatfinbot.audio.v1;

option go_package = ".;audiopb";
import "google/api/annotations.proto";

service AudioService {
    rpc CreateRecord(CreateRecordReq) returns (CreateRecordRsp) {
        option (google.api.http) = {
			post: "/v1/audio/record",
			body: "*"
		};
    };
    rpc GetRecordList(GetRecordListReq) returns (GetRecordListRsp) {
        option (google.api.http) = {
			get: "/v1/audio/record-list"
		};
    };
    rpc GetRecordStatus(GetRecordStatusReq) returns (GetRecordStatusRsp) {
        option (google.api.http) = {
			get: "/v1/audio/record-status"
		};
    };
    rpc Transcription(TranscriptionReq) returns (TranscriptionRsp) {
        option (google.api.http) = {
			post: "/v1/audio/trans",
            body: "*"
		};
    };
    rpc GetTransData(GetTransDataReq) returns (GetTransDataRsp) {
        option (google.api.http) = {
			get: "/v1/audio/trans-data"
		};
    };
}

message CreateRecordReq {
    string session_id = 1; // session id
    string doc_id = 2; // 文件id
}

message CreateRecordRsp {
    string job_id = 1; // 获取任务id
}

message GetRecordListReq {
    string session_id = 1; // session id
    uint32 page = 2; // 页码 
    uint32 page_size = 3; // 页数
}

message GetRecordListRsp {
    repeated MediaRecord list = 1;
}

message MediaRecord {
    string doc_id = 1; // 文件id
    repeated MediaContent content = 2; // 内容
    string session_id = 3; // session id
    string summary = 4; // 总结
    string create_at = 5; // 创建时间
    string update_at = 6; // 更新时间
    uint32 status = 7; //进度
    string schedule = 8; // 进度 
    string url = 9; // 视频链接地址 
    uint32 media_type = 10; // 媒体类型 
    repeated MediaSummary partial_summary = 11; // 部分内容
    
}

message GetRecordStatusReq {
    string job_id = 1; // 任务id
}

message GetRecordStatusRsp {
    MediaRecord data = 1;
}

message TranscriptionReq {
    string doc_id = 1; // 音频id
    string session_id = 2; // session id
    repeated MediaContent content = 3; // 追加内容
    uint32 stype = 4; // 状态 1=追加 2=覆盖 3=结束录制   2=后面会去掉
}

message MediaContent {
    string start = 1;
    string text = 2;
    double duration = 3;
    string role = 4;
}

message MediaSummary {
    string start = 1;
    string text = 2;
}

message TranscriptionRsp {
    int32 code = 1; 
    string message = 2;
}

message GetTransDataReq {
    string session_id = 1; // session id
}

message GetTransDataRsp {
    MediaRecord data = 1;
}